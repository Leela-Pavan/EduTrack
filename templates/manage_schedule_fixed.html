{% extends "base.html" %}

{% block title %}Manage Schedule - EduTrack{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 mb-1">
                        <i class="fas fa-calendar-alt me-2 text-info"></i>Schedule Management
                    </h1>
                    <p class="text-muted">Create and manage timetables for classes and teachers</p>
                </div>
                <a href="/admin/dashboard" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-1"></i>Back to Dashboard
                </a>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex flex-wrap gap-2">
                        <button class="btn btn-primary" onclick="showAddScheduleModal()">
                            <i class="fas fa-plus me-1"></i>Add New Schedule
                        </button>
                        <button class="btn btn-info" onclick="showBulkScheduleModal()">
                            <i class="fas fa-calendar-plus me-1"></i>Bulk Add Schedule
                        </button>
                        <button class="btn btn-warning" onclick="checkConflicts()">
                            <i class="fas fa-exclamation-triangle me-1"></i>Check Conflicts
                        </button>
                        <button class="btn btn-success" onclick="generateReport()">
                            <i class="fas fa-file-export me-1"></i>Generate Report
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Class Tabs -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs" id="classTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="CSIT-A-tab" data-bs-toggle="tab" data-bs-target="#CSIT-A" type="button" role="tab">
                                CSIT-A
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="CSIT-B-tab" data-bs-toggle="tab" data-bs-target="#CSIT-B" type="button" role="tab">
                                CSIT-B
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="CSD-A-tab" data-bs-toggle="tab" data-bs-target="#CSD-A" type="button" role="tab">
                                CSD-A
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="CSD-B-tab" data-bs-toggle="tab" data-bs-target="#CSD-B" type="button" role="tab">
                                CSD-B
                            </button>
                        </li>
                    </ul>
                </div>
                <div class="card-body">
                    <div class="tab-content" id="classTabsContent">
                        <!-- CSIT-A Tab -->
                        <div class="tab-pane fade show active" id="CSIT-A" role="tabpanel">
                            <h5 class="text-primary mb-3">CSIT-A Timetable</h5>
                            <div class="table-responsive">
                                <table class="table table-bordered table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th style="width: 120px;">Time/Day</th>
                                            {% for day in days %}
                                                <th class="text-center">{{ day }}</th>
                                            {% endfor %}
                                        </tr>
                                    </thead>
                                    <tbody id="schedule-CSIT-A">
                                        {% for period in periods %}
                                            <tr>
                                                <td class="table-secondary fw-bold">
                                                    Period {{ period.number }}<br>
                                                    <small class="text-muted">{{ period.time }}</small>
                                                </td>
                                                {% for day in days %}
                                                    <td class="text-center schedule-cell" 
                                                        data-class="CSIT" 
                                                        data-section="A"
                                                        data-day="{{ day }}" 
                                                        data-period="{{ period.number }}"
                                                        data-time="{{ period.time }}"
                                                        onclick="editScheduleCell(this)">
                                                        <div class="schedule-content">
                                                            <span class="text-muted">Click to add</span>
                                                        </div>
                                                    </td>
                                                {% endfor %}
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- CSIT-B Tab -->
                        <div class="tab-pane fade" id="CSIT-B" role="tabpanel">
                            <h5 class="text-primary mb-3">CSIT-B Timetable</h5>
                            <div class="table-responsive">
                                <table class="table table-bordered table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th style="width: 120px;">Time/Day</th>
                                            {% for day in days %}
                                                <th class="text-center">{{ day }}</th>
                                            {% endfor %}
                                        </tr>
                                    </thead>
                                    <tbody id="schedule-CSIT-B">
                                        {% for period in periods %}
                                            <tr>
                                                <td class="table-secondary fw-bold">
                                                    Period {{ period.number }}<br>
                                                    <small class="text-muted">{{ period.time }}</small>
                                                </td>
                                                {% for day in days %}
                                                    <td class="text-center schedule-cell" 
                                                        data-class="CSIT" 
                                                        data-section="B"
                                                        data-day="{{ day }}" 
                                                        data-period="{{ period.number }}"
                                                        data-time="{{ period.time }}"
                                                        onclick="editScheduleCell(this)">
                                                        <div class="schedule-content">
                                                            <span class="text-muted">Click to add</span>
                                                        </div>
                                                    </td>
                                                {% endfor %}
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- CSD-A Tab -->
                        <div class="tab-pane fade" id="CSD-A" role="tabpanel">
                            <h5 class="text-primary mb-3">CSD-A Timetable</h5>
                            <div class="table-responsive">
                                <table class="table table-bordered table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th style="width: 120px;">Time/Day</th>
                                            {% for day in days %}
                                                <th class="text-center">{{ day }}</th>
                                            {% endfor %}
                                        </tr>
                                    </thead>
                                    <tbody id="schedule-CSD-A">
                                        {% for period in periods %}
                                            <tr>
                                                <td class="table-secondary fw-bold">
                                                    Period {{ period.number }}<br>
                                                    <small class="text-muted">{{ period.time }}</small>
                                                </td>
                                                {% for day in days %}
                                                    <td class="text-center schedule-cell" 
                                                        data-class="CSD" 
                                                        data-section="A"
                                                        data-day="{{ day }}" 
                                                        data-period="{{ period.number }}"
                                                        data-time="{{ period.time }}"
                                                        onclick="editScheduleCell(this)">
                                                        <div class="schedule-content">
                                                            <span class="text-muted">Click to add</span>
                                                        </div>
                                                    </td>
                                                {% endfor %}
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- CSD-B Tab -->
                        <div class="tab-pane fade" id="CSD-B" role="tabpanel">
                            <h5 class="text-primary mb-3">CSD-B Timetable</h5>
                            <div class="table-responsive">
                                <table class="table table-bordered table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th style="width: 120px;">Time/Day</th>
                                            {% for day in days %}
                                                <th class="text-center">{{ day }}</th>
                                            {% endfor %}
                                        </tr>
                                    </thead>
                                    <tbody id="schedule-CSD-B">
                                        {% for period in periods %}
                                            <tr>
                                                <td class="table-secondary fw-bold">
                                                    Period {{ period.number }}<br>
                                                    <small class="text-muted">{{ period.time }}</small>
                                                </td>
                                                {% for day in days %}
                                                    <td class="text-center schedule-cell" 
                                                        data-class="CSD" 
                                                        data-section="B"
                                                        data-day="{{ day }}" 
                                                        data-period="{{ period.number }}"
                                                        data-time="{{ period.time }}"
                                                        onclick="editScheduleCell(this)">
                                                        <div class="schedule-content">
                                                            <span class="text-muted">Click to add</span>
                                                        </div>
                                                    </td>
                                                {% endfor %}
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Teacher Schedule Overview -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-users me-2"></i>Teacher Schedule Overview
                    </h5>
                </div>
                <div class="card-body">
                    <div id="teacherOverview">
                        <div class="text-center text-muted">
                            <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                            Loading teacher schedules...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Schedule Modal -->
<div class="modal fade" id="addScheduleModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Schedule Entry</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addScheduleForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Class</label>
                            <select class="form-select" id="scheduleClass" required>
                                <option value="CSIT-A">CSIT-A</option>
                                <option value="CSIT-B">CSIT-B</option>
                                <option value="CSD-A">CSD-A</option>
                                <option value="CSD-B">CSD-B</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Day</label>
                            <select class="form-select" id="scheduleDay" required>
                                {% for day in days %}
                                    <option value="{{ day }}">{{ day }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Period</label>
                            <select class="form-select" id="schedulePeriod" required>
                                {% for period in periods %}
                                    <option value="{{ period.number }}">Period {{ period.number }} ({{ period.time }})</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Subject</label>
                            <select class="form-select" id="scheduleSubject" required>
                                <option value="">Select Subject</option>
                                {% for subject in subjects %}
                                    <option value="{{ subject }}">{{ subject }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Teacher</label>
                        <select class="form-select" id="scheduleTeacher" required>
                            <option value="">Select Teacher</option>
                            {% for teacher in teachers %}
                                <option value="{{ teacher[0] }}">{{ teacher[1] }} {{ teacher[2] }} ({{ teacher[3] }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Start Time</label>
                            <input type="time" class="form-control" id="scheduleStartTime" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">End Time</label>
                            <input type="time" class="form-control" id="scheduleEndTime" required>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveSchedule()">Save Schedule</button>
            </div>
        </div>
    </div>
</div>

<!-- Bulk Schedule Modal -->
<div class="modal fade" id="bulkScheduleModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Bulk Add Schedule</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p class="text-muted">Add the same subject/teacher to multiple time slots at once.</p>
                <form id="bulkScheduleForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Subject</label>
                            <select class="form-select" id="bulkSubject" required>
                                <option value="">Select Subject</option>
                                {% for subject in subjects %}
                                    <option value="{{ subject }}">{{ subject }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Teacher</label>
                            <select class="form-select" id="bulkTeacher" required>
                                <option value="">Select Teacher</option>
                                {% for teacher in teachers %}
                                    <option value="{{ teacher[0] }}">{{ teacher[1] }} {{ teacher[2] }} ({{ teacher[3] }})</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Select Classes</label>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="CSIT-A" id="bulkClassCSITA">
                                    <label class="form-check-label" for="bulkClassCSITA">CSIT-A</label>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="CSIT-B" id="bulkClassCSITB">
                                    <label class="form-check-label" for="bulkClassCSITB">CSIT-B</label>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="CSD-A" id="bulkClassCSDA">
                                    <label class="form-check-label" for="bulkClassCSDA">CSD-A</label>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="CSD-B" id="bulkClassCSDB">
                                    <label class="form-check-label" for="bulkClassCSDB">CSD-B</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Select Days</label>
                        <div class="row">
                            {% for day in days %}
                                <div class="col-md-2">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="{{ day }}" id="bulkDay{{ loop.index }}">
                                        <label class="form-check-label" for="bulkDay{{ loop.index }}">{{ day[:3] }}</label>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Select Periods</label>
                        <div class="row">
                            {% for period in periods %}
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="{{ period.number }}" id="bulkPeriod{{ period.number }}">
                                        <label class="form-check-label" for="bulkPeriod{{ period.number }}">P{{ period.number }} ({{ period.time }})</label>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveBulkSchedule()">Save Bulk Schedule</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
// Global variables
let currentEditCell = null;
let scheduleData = {};

// Load existing schedules when page loads
document.addEventListener('DOMContentLoaded', function() {
    loadExistingSchedules();
    loadTeacherOverview();
});

// Load existing schedules from database
function loadExistingSchedules() {
    fetch('/api/schedules')
        .then(response => response.json())
        .then(schedules => {
            scheduleData = {};
            
            // Clear all cells first
            document.querySelectorAll('.schedule-cell').forEach(cell => {
                cell.innerHTML = '<div class="schedule-content"><span class="text-muted">Click to add</span></div>';
                cell.classList.remove('table-success', 'table-warning');
            });
            
            // Populate schedule data
            schedules.forEach(schedule => {
                const key = `${schedule.class_name}-${schedule.section}-${schedule.day_of_week}-${schedule.period_number}`;
                scheduleData[key] = schedule;
                
                // Find the corresponding cell
                const cell = document.querySelector(`[data-class="${schedule.class_name}"][data-section="${schedule.section}"][data-day="${schedule.day_of_week}"][data-period="${schedule.period_number}"]`);
                if (cell) {
                    cell.innerHTML = `
                        <div class="schedule-content">
                            <strong class="text-primary">${schedule.subject}</strong><br>
                            <small class="text-success">${schedule.teacher_name || 'No Teacher'}</small><br>
                            <small class="text-muted">${schedule.start_time}-${schedule.end_time}</small>
                        </div>
                    `;
                    cell.classList.add('table-success');
                }
            });
        })
        .catch(error => {
            console.error('Error loading schedules:', error);
        });
}

// Edit schedule cell
function editScheduleCell(cell) {
    currentEditCell = cell;
    const classSection = cell.dataset.class + '-' + cell.dataset.section;
    const day = cell.dataset.day;
    const period = cell.dataset.period;
    const key = `${cell.dataset.class}-${cell.dataset.section}-${day}-${period}`;
    
    // Fill modal with current data or defaults
    document.getElementById('scheduleClass').value = classSection;
    document.getElementById('scheduleDay').value = day;
    document.getElementById('schedulePeriod').value = period;
    
    // Fill existing data if available
    if (scheduleData[key]) {
        document.getElementById('scheduleSubject').value = scheduleData[key].subject;
        document.getElementById('scheduleTeacher').value = scheduleData[key].teacher_id || '';
        document.getElementById('scheduleStartTime').value = scheduleData[key].start_time;
        document.getElementById('scheduleEndTime').value = scheduleData[key].end_time;
    } else {
        // Set default times based on period
        const periodTimes = {
            1: {start: '09:00', end: '09:50'},
            2: {start: '09:50', end: '10:40'},
            3: {start: '11:00', end: '11:50'},
            4: {start: '11:50', end: '12:40'},
            5: {start: '13:30', end: '14:20'},
            6: {start: '14:20', end: '15:10'},
            7: {start: '15:30', end: '16:20'},
            8: {start: '16:20', end: '17:10'}
        };
        
        const times = periodTimes[parseInt(period)] || {start: '09:00', end: '09:50'};
        document.getElementById('scheduleStartTime').value = times.start;
        document.getElementById('scheduleEndTime').value = times.end;
        
        // Clear other fields
        document.getElementById('scheduleSubject').value = '';
        document.getElementById('scheduleTeacher').value = '';
    }
    
    // Show modal
    const modal = new bootstrap.Modal(document.getElementById('addScheduleModal'));
    modal.show();
}

// Save schedule
function saveSchedule() {
    const form = document.getElementById('addScheduleForm');
    if (!form.checkValidity()) {
        form.reportValidity();
        return;
    }
    
    const classSection = document.getElementById('scheduleClass').value.split('-');
    const scheduleData = {
        class_name: classSection[0],
        section: classSection[1],
        day_of_week: document.getElementById('scheduleDay').value,
        period_number: parseInt(document.getElementById('schedulePeriod').value),
        subject: document.getElementById('scheduleSubject').value,
        teacher_id: document.getElementById('scheduleTeacher').value || null,
        start_time: document.getElementById('scheduleStartTime').value,
        end_time: document.getElementById('scheduleEndTime').value
    };
    
    fetch('/api/schedule', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(scheduleData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Close modal
            bootstrap.Modal.getInstance(document.getElementById('addScheduleModal')).hide();
            
            // Reload schedules
            loadExistingSchedules();
            loadTeacherOverview();
            
            // Show success message
            showAlert('Schedule saved successfully!', 'success');
        } else {
            showAlert('Error: ' + data.error, 'danger');
        }
    })
    .catch(error => {
        console.error('Error saving schedule:', error);
        showAlert('Error saving schedule', 'danger');
    });
}

// Show modals
function showAddScheduleModal() {
    currentEditCell = null;
    document.getElementById('addScheduleForm').reset();
    
    // Set default times for period 1
    document.getElementById('scheduleStartTime').value = '09:00';
    document.getElementById('scheduleEndTime').value = '09:50';
    
    const modal = new bootstrap.Modal(document.getElementById('addScheduleModal'));
    modal.show();
}

function showBulkScheduleModal() {
    document.getElementById('bulkScheduleForm').reset();
    const modal = new bootstrap.Modal(document.getElementById('bulkScheduleModal'));
    modal.show();
}

// Save bulk schedule
function saveBulkSchedule() {
    const subject = document.getElementById('bulkSubject').value;
    const teacherId = document.getElementById('bulkTeacher').value;
    
    if (!subject || !teacherId) {
        showAlert('Please select subject and teacher', 'warning');
        return;
    }
    
    // Get selected classes, days, and periods
    const selectedClasses = Array.from(document.querySelectorAll('input[id^="bulkClass"]:checked')).map(cb => cb.value);
    const selectedDays = Array.from(document.querySelectorAll('input[id^="bulkDay"]:checked')).map(cb => cb.value);
    const selectedPeriods = Array.from(document.querySelectorAll('input[id^="bulkPeriod"]:checked')).map(cb => parseInt(cb.value));
    
    if (selectedClasses.length === 0 || selectedDays.length === 0 || selectedPeriods.length === 0) {
        showAlert('Please select at least one class, day, and period', 'warning');
        return;
    }
    
    const bulkData = {
        classes: selectedClasses,
        days: selectedDays,
        periods: selectedPeriods,
        subject: subject,
        teacher_id: teacherId
    };
    
    fetch('/api/bulk-schedule', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(bulkData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            bootstrap.Modal.getInstance(document.getElementById('bulkScheduleModal')).hide();
            loadExistingSchedules();
            loadTeacherOverview();
            showAlert(`${data.created} schedule entries created successfully!`, 'success');
        } else {
            showAlert('Error: ' + data.error, 'danger');
        }
    })
    .catch(error => {
        console.error('Error saving bulk schedule:', error);
        showAlert('Error saving bulk schedule', 'danger');
    });
}

// Load teacher overview
function loadTeacherOverview() {
    fetch('/api/teacher-schedules')
        .then(response => response.json())
        .then(data => {
            const container = document.getElementById('teacherOverview');
            
            if (Object.keys(data).length === 0) {
                container.innerHTML = '<p class="text-muted text-center">No teacher schedules found.</p>';
                return;
            }
            
            let html = '<div class="row">';
            Object.keys(data).forEach(teacherName => {
                const schedules = data[teacherName];
                html += `
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="card border-success">
                            <div class="card-header bg-success text-white">
                                <h6 class="mb-0">${teacherName}</h6>
                                <small>${schedules.length} periods assigned</small>
                            </div>
                            <div class="card-body p-2">
                                <div class="table-responsive">
                                    <table class="table table-sm mb-0">
                                        <tbody>
                `;
                
                schedules.slice(0, 5).forEach(schedule => {
                    html += `
                        <tr>
                            <td class="py-1"><small>${schedule.class_name}-${schedule.section}</small></td>
                            <td class="py-1"><small>${schedule.day_of_week.substr(0,3)}</small></td>
                            <td class="py-1"><small>P${schedule.period_number}</small></td>
                        </tr>
                    `;
                });
                
                if (schedules.length > 5) {
                    html += `<tr><td colspan="3" class="text-center py-1"><small class="text-muted">+${schedules.length - 5} more</small></td></tr>`;
                }
                
                html += `
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            container.innerHTML = html;
        })
        .catch(error => {
            console.error('Error loading teacher overview:', error);
            document.getElementById('teacherOverview').innerHTML = '<p class="text-danger text-center">Error loading teacher schedules.</p>';
        });
}

// Utility functions
function checkConflicts() {
    fetch('/api/schedule-conflicts')
        .then(response => response.json())
        .then(data => {
            if (data.conflicts && data.conflicts.length > 0) {
                let message = 'Schedule Conflicts Found:\n\n';
                data.conflicts.forEach(conflict => {
                    message += `• ${conflict.description}\n`;
                });
                alert(message);
            } else {
                showAlert('No schedule conflicts found! ✅', 'success');
            }
        })
        .catch(error => {
            console.error('Error checking conflicts:', error);
            showAlert('Error checking schedule conflicts', 'danger');
        });
}

function generateReport() {
    window.open('/api/schedule-report', '_blank');
}

function showAlert(message, type) {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
    alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; max-width: 400px;';
    alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(alertDiv);
    
    // Auto dismiss after 5 seconds
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.remove();
        }
    }, 5000);
}
</script>

<style>
.schedule-cell {
    height: 80px;
    vertical-align: middle;
    cursor: pointer;
    transition: background-color 0.2s;
}

.schedule-cell:hover {
    background-color: #f8f9fa !important;
}

.schedule-content {
    font-size: 0.85em;
    line-height: 1.2;
}

.nav-tabs .nav-link {
    color: #495057;
    border: 1px solid transparent;
}

.nav-tabs .nav-link.active {
    color: #0d6efd;
    background-color: #fff;
    border-color: #dee2e6 #dee2e6 #fff;
}

.table th {
    border-top: none;
}

.card-header-tabs {
    margin-bottom: -1rem;
}

.card-header-tabs .nav-link {
    border-top-left-radius: 0.375rem;
    border-top-right-radius: 0.375rem;
}
</style>
{% endblock %}